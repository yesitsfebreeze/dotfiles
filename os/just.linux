install:
  @just link

link:
  #!/usr/bin/env bash
  set -euo pipefail
  shopt -s dotglob
  find src -type f | while read -r file; do
    just __link "$file"
  done

__link src:
  #!/usr/bin/env bash
  set -euo pipefail
  first_line=$(head -n 1 "{{src}}")
  [[ ! "${first_line:0:5}" =~ "@" ]] && exit 0
  dest=$(eval echo "${first_line#*@}")
  [ -z "$dest" ] && exit 1
  mkdir -p "$(dirname "$dest")"
  rm -f "$dest"
  ln -sf "$(pwd)/{{src}}" "$dest"
  echo "Linked $(basename "{{src}}")"
